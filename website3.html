<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice Editor</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
  h2 { margin-bottom: 20px; }
  .invoice-field { display: block; margin: 10px 0; padding: 8px; width: 100%; max-width: 400px; }
  .invoice-table { border-collapse: collapse; width: 100%; max-width: 600px; margin-top: 20px; }
  .invoice-table th, .invoice-table td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  .invoice-table th { background-color: #eee; }
  #preview { border: 1px solid #ccc; padding: 10px; margin-top: 20px; background: #fff; max-width: 600px; }
  .add-item { margin-top: 10px; padding: 5px 10px; cursor: pointer; }
</style>
</head>
<body>

<h2>Invoice Editor</h2>

<label>Invoice Title:</label>
<input id="invoiceTitle" class="invoice-field" placeholder="Invoice Title">

<label>Client Name:</label>
<input id="clientName" class="invoice-field" placeholder="Client Name">

<label>Invoice Items:</label>
<table id="itemsTable" class="invoice-table">
  <thead>
    <tr>
      <th>Item</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Total</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="itemsBody">
    <!-- Items added dynamically -->
  </tbody>
</table>
<button id="addItemBtn" class="add-item">Add Item</button>

<div id="preview">
  <h3 id="previewTitle">Title: </h3>
  <p id="previewClient">Client: </p>
  <h4>Items:</h4>
  <table id="previewItems" class="invoice-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      <!-- Preview items -->
    </tbody>
  </table>
  <h4 id="previewTotal">Total: 0</h4>
</div>

<script>
  // Debounce helper
  function debounce(func, delay) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), delay);
    };
  }

  const invoiceTitle = document.getElementById('invoiceTitle');
  const clientName = document.getElementById('clientName');
  const itemsBody = document.getElementById('itemsBody');
  const addItemBtn = document.getElementById('addItemBtn');
  const previewTitle = document.getElementById('previewTitle');
  const previewClient = document.getElementById('previewClient');
  const previewItems = document.querySelector('#previewItems tbody');
  const previewTotal = document.getElementById('previewTotal');

  let items = JSON.parse(localStorage.getItem('invoiceItems')) || [];

  function updatePreview() {
    previewTitle.textContent = `Title: ${invoiceTitle.value}`;
    previewClient.textContent = `Client: ${clientName.value}`;

    // Clear preview items
    previewItems.innerHTML = '';
    let total = 0;
    items.forEach((item, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td>${item.price}</td>
        <td>${(item.qty * item.price).toFixed(2)}</td>
      `;
      previewItems.appendChild(tr);
      total += item.qty * item.price;
    });
    previewTotal.textContent = `Total: ${total.toFixed(2)}`;
  }

  function saveItems() {
    localStorage.setItem('invoiceItems', JSON.stringify(items));
  }

  function renderItems() {
    itemsBody.innerHTML = '';
    items.forEach((item, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" value="${item.name}" data-index="${index}" class="itemName"></td>
        <td><input type="number" value="${item.qty}" data-index="${index}" class="itemQty" min="0"></td>
        <td><input type="number" value="${item.price}" data-index="${index}" class="itemPrice" min="0" step="0.01"></td>
        <td>${(item.qty * item.price).toFixed(2)}</td>
        <td><button data-index="${index}" class="deleteItem">Delete</button></td>
      `;
      itemsBody.appendChild(tr);
    });
    updatePreview();
  }

  // Event delegation for item changes
  itemsBody.addEventListener('input', debounce(function(e) {
    const target = e.target;
    const index = target.dataset.index;
    if (target.classList.contains('itemName')) items[index].name = target.value;
    if (target.classList.contains('itemQty')) items[index].qty = parseFloat(target.value) || 0;
    if (target.classList.contains('itemPrice')) items[index].price = parseFloat(target.value) || 0;
    saveItems();
    renderItems();
  }, 200));

  // Delete item
  itemsBody.addEventListener('click', function(e) {
    if (e.target.classList.contains('deleteItem')) {
      const index = e.target.dataset.index;
      items.splice(index, 1);
      saveItems();
      renderItems();
    }
  });

  // Add new item
  addItemBtn.addEventListener('click', () => {
    items.push({name:'', qty:0, price:0});
    saveItems();
    renderItems();
  });

  // Save title & client
  invoiceTitle.addEventListener('input', debounce(() => {
    localStorage.setItem('invoiceTitle', invoiceTitle.value);
    updatePreview();
  }, 300));

  clientName.addEventListener('input', debounce(() => {
    localStorage.setItem('clientName', clientName.value);
    updatePreview();
  }, 300));

  // Load saved title & client
  invoiceTitle.value = localStorage.getItem('invoiceTitle') || '';
  clientName.value = localStorage.getItem('clientName') || '';
  renderItems();
</script>

</body>
</html>